
@diagram[KLayLayered] false
scchart HistoryDeep {
  input bool H, R;
  output int leaveState;
  output int State;
  int _M;
  int _M2;
  bool _trig;
  bool _trig2;

  state MHist
  --> M;

  state M {
    bool _term;

    region _Entry:

    state _Main {

      state _Depth4 {

        state S11 {

          region _Entry:

          initial state _Init
          --> _C immediate with / State = 11;

          final state _Done;

          state _C
          --> _Done immediate with / _M2 = 0;
        }
        >-> _Exit;

        state _Depth2 {

          region _Entry:

          initial state _Init
          --> _C immediate with / State = 12;

          final state _Done;

          state _C
          --> _Done immediate with / _M2 = 1;
        }
        >-> _Exit2;
        @finalstate ""

        final state S13;

        state _Init
        --> S11 immediate with _M2 == 0
        --> _S immediate;

        state _Depth3
        --> _C2 immediate with / _term = true;

        final state _Aborted2;

        initial state _Init2
        --> _C immediate with / _M = 0;

        state _C
        --> _Init immediate with / _term = false;

        state _Exit
        --> _Aborted2 immediate with _trig || _trig2
        --> _Pause2 immediate;

        state _Exit2
        --> _Aborted2 immediate with _trig || _trig2
        --> _Pause3 immediate;

        state _C2
        --> _C3 immediate with / State = 13;

        state _C3
        --> S13 immediate with / _M2 = 2;

        state _S
        --> _Depth3 immediate with _M2 == 2
        --> _S2 immediate;

        state _S2
        --> _Depth2 immediate with _M2 == 1
        --> _S3 immediate;

        state _S3
        --> _Aborted2 immediate with _trig || _trig2
        --> _Pause immediate;

        state _Pause
        --> _Depth;

        state _Depth
        --> S11 immediate with _M2 == 0
        --> _S5 immediate;

        state _S5
        --> _Depth3 immediate with _M2 == 2
        --> _S6 immediate;

        state _S6
        --> _Depth2 immediate with _M2 == 1
        --> _S3 immediate;

        state _Pause2
        --> _Depth2;

        state _Pause3
        --> _Depth3;
      }
      >-> _C2;

      state S2 {

        region _Entry:

        initial state _Init
        --> _C immediate with / State = 2;

        final state _Done;

        state _C
        --> _Done immediate with / _M = 1;
      }
      >-> _Exit;

      state _Depth2 {

        region _Entry:

        initial state _Init
        --> _C immediate with / State = 3;

        final state _Done;

        state _C
        --> _Done immediate with / _M = 2;
      }
      >-> _Exit2;

      state _Depth3 {

        region _Entry:

        initial state _Init
        --> _C immediate with / State = 4;

        final state _Done;

        state _C
        --> _Done immediate with / _M = 3;
      }
      >-> _Exit3;

      initial state _Init
      --> _Depth4 immediate with _M == 0
      --> _S immediate;

      final state _Aborted;

      state _C2
      @terminationtransition ""
      --> S2 immediate with _term
      --> _Aborted immediate;

      state _Exit
      --> _Aborted immediate with _trig || _trig2
      --> _Pause2 immediate;

      state _Exit2
      --> _Aborted immediate with _trig || _trig2
      --> _Pause3 immediate;

      state _Exit3
      --> _Aborted immediate with _trig || _trig2
      --> _Pause4 immediate;

      state _S
      --> _Depth3 immediate with _M == 3
      --> _S2 immediate;

      state _S2
      --> _Depth2 immediate with _M == 2
      --> _S3 immediate;

      state _S3
      --> S2 immediate with _M == 1
      --> _Pause immediate;

      state _Pause
      --> _Depth;

      state _Depth
      --> _Depth4 immediate with _M == 0
      --> _S5 immediate;

      state _S5
      --> _Depth3 immediate with _M == 3
      --> _S6 immediate;

      state _S6
      --> _Depth2 immediate with _M == 2
      --> _S7 immediate;

      state _S7
      --> S2 immediate with _M == 1
      --> _S8 immediate;

      state _S8
      --> _Aborted immediate with _trig || _trig2
      --> _Pause immediate;

      state _Pause2
      --> _Depth2;

      state _Pause3
      --> _Depth3;

      state _Pause4
      --> _Depth4;

      region _Ctrl:

      final state _Done;

      state _S
      --> _Done immediate with / _trig = true;

      state _S2
      --> _Done immediate with / _trig2 = true;

      initial state _Run
      --> _Depth;

      state _Depth
      --> _S immediate with H
      --> _S4 immediate;

      state _S4
      --> _S2 immediate with R
      --> _Run immediate;
    }
    >-> _Done;

    initial state _Init
    --> _C immediate with / _trig = false;

    final state _Done;

    state _C
    --> _Main immediate with / _trig2 = false;
  }
  >-> _C;

  state MReset
  --> _S;

  state _C
  --> MHist immediate with _trig
  --> MReset immediate;

  initial state _Init
  --> _C2 immediate with / leaveState = 1;

  state _C2
  --> _C3 immediate with / _M = 0;

  state _C3
  --> MHist immediate with / _M2 = 0;

  state _S
  --> _S2 immediate with / _M = 0;

  state _S2
  --> M immediate with / _M2 = 0;
}